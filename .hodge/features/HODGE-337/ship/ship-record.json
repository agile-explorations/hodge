{
  "feature": "HODGE-337",
  "timestamp": "2025-10-09T19:06:40.555Z",
  "issueId": "HODGE-337",
  "pmTool": "linear",
  "validationPassed": true,
  "shipChecks": {
    "tests": true,
    "coverage": true,
    "docs": true,
    "changelog": true
  },
  "commitMessage": "feat: fix version-specific profile filtering in review manifest generator (HODGE-337)\n\n## What Changed\n\n**Core Infrastructure** (6 new files, 1311 lines):\n- src/lib/review-manifest-generator.ts: Generates review manifests with tiered recommendations\n- src/lib/review-tier-classifier.ts: Classifies changes into SKIP/QUICK/STANDARD/FULL tiers\n- src/lib/git-diff-analyzer.ts: Parses git diff output for change analysis\n- src/types/review-manifest.ts: Type definitions for review manifest structure\n- .hodge/review-tier-config.yaml: Configuration for tier classification rules\n\n**Bug Fix** (semver version filtering):\n- Added semver dependency (^7.7.3) to package.json\n- Implemented getInstalledVersion() helper to read package.json versions\n- Added version_range checking using semver.satisfies()\n- Fixed profile filtering to match only installed dependency versions (e.g., vitest ^3.2.4 → vitest-3.x.md only)\n\n**Test Coverage** (3 test files, 452 lines):\n- src/lib/review-manifest-generator.smoke.test.ts: 5 smoke tests including version filtering\n- src/lib/review-tier-classifier.smoke.test.ts: 3 smoke tests for tier classification\n- src/commands/harden.smoke.test.ts: 7 smoke tests for harden command integration\n\n**Review Profiles** (4 new profiles, 215 lines):\n- .hodge/review-profiles/testing/vitest-3.x.md: Vitest 3.x specific best practices\n- .hodge/review-profiles/frameworks/nextjs-12.x.md: Next.js 12.x placeholder\n- .hodge/review-profiles/frameworks/nextjs-13.x.md: Next.js 13.x placeholder  \n- .hodge/review-profiles/frameworks/nextjs-14.x.md: Next.js 14.x placeholder\n\n**Command Integration** (2 files modified, 187 lines changed):\n- src/commands/harden.ts: Integrated review manifest generation with --review flag\n- .claude/commands/harden.md: Updated template with review report generation step\n\n**Template Updates**:\n- src/lib/claude-commands.ts: Auto-synced from harden.md template changes\n- .claude/commands/build.md: Minor template updates\n\n## Why This Change\n\n**Bug**: Review manifest was including ALL version-specific profiles (vitest-1.x, vitest-3.x, vitest-0.34+, typescript-4.x, typescript-5.x) instead of only the versions matching installed dependencies. This occurred because profile filtering checked for dependency existence but never validated the version_range field from profile frontmatter.\n\n**Solution**: Implemented semver-based version matching that:\n1. Reads installed version from package.json (dependencies + devDependencies)\n2. Normalizes version strings using semver.coerce() (handles ^, ~, >= prefixes)\n3. Matches against version ranges using semver.satisfies()\n4. Skips profiles that don't match the installed version\n\n**Verification**: After fix, review manifest correctly shows only 4 profiles (vitest-3.x.md, typescript-5.x.md, general-test-standards.md, general-coding-standards.md) instead of 7.\n\n## Impact\n\n✅ **Correctness**: Review profiles now match installed dependency versions\n- Prevents incorrect guidance from wrong framework versions\n- Enables accurate version-specific best practices\n\n✅ **Developer Experience**:\n- /harden command runs AI code review before validation tests\n- Review reports persist findings for future reference\n- Tiered review system scales from small changes to full refactors\n\n✅ **Code Quality**:\n- 15 new tests (all passing): 5 manifest generation + 3 tier classification + 7 harden integration\n- All 901 tests passing (flaky parallel execution issues pre-existing, not introduced)\n- Zero breaking changes to existing functionality\n\n✅ **Architecture**:\n- Clean separation: CLI discovers files, AI interprets content\n- Follows established patterns: CLI = structure, AI = content generation\n- Service class pattern: ReviewManifestGenerator extracts testable logic\n\n**Pattern**: Semver-based version filtering enables accurate technology-specific guidance across the codebase.\n\nCloses HODGE-337"
}